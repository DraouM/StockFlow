<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../../../assets/styles/main.css" />
    <link rel="stylesheet" href="buying.css" />
  </head>
  <body>
    <h1>Buying Page</h1>

    <button data-modal="newProductModal" class="button button-secondary">
      Create New Product
    </button>

    <main class="main-container">
      <section class="product-section">
        <!-- Your product search form here -->
        <div class="search-container">
          <form id="search-form" class="search-form">
            <input
              type="text"
              class="search-input"
              id="search-input"
              placeholder="Search for a Product"
              autocomplete="off"
            />
            <button type="submit" id="search-btn" class="search-btn">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="23"
                viewBox="0 0 22 23"
                fill="none"
              >
                <path
                  d="M16.4998 16.9997L13.2515 13.7513M13.2515 13.7513C13.7728 13.2299 14.1864 12.611 14.4686 11.9298C14.7508 11.2486 14.896 10.5184 14.896 9.7811C14.896 9.04376 14.7508 8.31364 14.4686 7.63243C14.1864 6.95121 13.7728 6.33225 13.2515 5.81087C12.7301 5.28949 12.1111 4.87592 11.4299 4.59375C10.7487 4.31158 10.0186 4.16635 9.28125 4.16635C8.54391 4.16635 7.81379 4.31158 7.13258 4.59375C6.45137 4.87592 5.8324 5.28949 5.31102 5.81087C4.25806 6.86384 3.6665 8.29197 3.6665 9.7811C3.6665 11.2702 4.25806 12.6984 5.31102 13.7513C6.36399 14.8043 7.79213 15.3958 9.28125 15.3958C10.7704 15.3958 12.1985 14.8043 13.2515 13.7513Z"
                  stroke="#5B5B5B"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
          </form>
          <div id="search-results" class="search-results hidden">
            <ul id="results-list"></ul>
          </div>
        </div>

        <!-- Your product details form here -->
        <form id="product-details-form" class="product-details-form">
          <!-- Product Name -->
          <div class="form-group">
            <label for="productName">Product Name</label>
            <input
              type="text"
              id="productName"
              name="productName"
              required
              readonly
            />
            <small class="form-text">Enter the name of the product.</small>
          </div>

          <!-- Product Quantity -->
          <div class="form-group">
            <label for="quantity">Quantity</label>
            <input type="number" id="quantity" name="quantity" required />
            <small class="form-text">Enter the quantity of the product.</small>
          </div>

          <!-- Unit Price -->
          <div class="form-group">
            <label for="unitPrice">Unit Price</label>
            <input type="number" id="unitPrice" name="unitPrice" required />
            <small class="form-text">The price per unit of the product.</small>
          </div>

          <!-- Total Price (Quantity * Unit Price) -->
          <div class="form-group">
            <label for="totalPrice">Total Price</label>
            <input
              type="number"
              id="totalPrice"
              name="totalPrice"
              required
              readonly
            />
            <small class="form-text"
              >Total cost based on quantity and unit price.</small
            >
          </div>

          <!-- ADD to list Button -->
          <button
            type="button"
            onclick="addToShoppingList()"
            class="button button-secondary"
          >
            Add to List
          </button>
        </form>

        <!-- Your shopping list here -->
        <div id="shopping-list-container" class="shopping-list-container">
          <h3>Shopping List</h3>
          <table id="shopping-list-table" class="shopping-list-table">
            <thead>
              <tr>
                <th>Product</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Total</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="shopping-list-body">
              <!-- Shopping list items will be inserted here -->
            </tbody>
          </table>
          <div class="shopping-list-summary">
            <p id="total-price" class="total-price">Total: $0.00</p>
            <button
              id="clear-list"
              onclick="clearShoppingList()"
              class="button button-danger"
            >
              Clear List
            </button>
          </div>
        </div>

        <!-- Confirm Transaction -->
        <button
          type="button button-primary"
          id="confirm-transaction"
          class="button button-primary"
        >
          Confirm Transaction
        </button>
      </section>

      <section class="client-section">
        <div class="client-info-section">
          <h2>Buyer Searchbar</h2>
          <!-- Your client search form here -->
          <div class="search-container">
            <form id="search-form-client" class="search-form">
              <input
                type="text"
                class="search-input"
                id="search-input-client"
                placeholder="Search for a Client"
                autocomplete="off"
              />
              <button type="submit" id="search-btn-client" class="search-btn">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="22"
                  height="23"
                  viewBox="0 0 22 23"
                  fill="none"
                >
                  <path
                    d="M16.4998 16.9997L13.2515 13.7513M13.2515 13.7513C13.7728 13.2299 14.1864 12.611 14.4686 11.9298C14.7508 11.2486 14.896 10.5184 14.896 9.7811C14.896 9.04376 14.7508 8.31364 14.4686 7.63243C14.1864 6.95121 13.7728 6.33225 13.2515 5.81087C12.7301 5.28949 12.1111 4.87592 11.4299 4.59375C10.7487 4.31158 10.0186 4.16635 9.28125 4.16635C8.54391 4.16635 7.81379 4.31158 7.13258 4.59375C6.45137 4.87592 5.8324 5.28949 5.31102 5.81087C4.25806 6.86384 3.6665 8.29197 3.6665 9.7811C3.6665 11.2702 4.25806 12.6984 5.31102 13.7513C6.36399 14.8043 7.79213 15.3958 9.28125 15.3958C10.7704 15.3958 12.1985 14.8043 13.2515 13.7513Z"
                    stroke="#5B5B5B"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
            </form>
            <div id="search-results-client" class="search-results hidden">
              <ul id="results-list-client"></ul>
            </div>
          </div>

          <!-- Your client details form here -->
          <form id="client-details-form" class="client-details-form">
            <!-- Client Name -->
            <div class="form-group">
              <label for="clientName">Client Name</label>
              <input
                type="text"
                id="clientName"
                name="clientName"
                required
                readonly
              />
            </div>

            <!-- Product Quantity -->
            <div class="form-group">
              <label for="clientAddress">Client Adrress</label>
              <input
                type="text"
                id="clientAddress"
                name="clientAddress"
                required
                readonly
              />
            </div>

            <!-- Client Phone -->
            <div class="form-group">
              <label for="clientPhone">Client Phone</label>
              <input
                type="text"
                id="clientPhone"
                name="clientPhone"
                required
                readonly
              />
            </div>

            <!--Client Total Debt -->
            <div class="form-group">
              <label for="clientDebt">Client Debt</label>
              <input
                type="number"
                id="clientDebt"
                name="clientDebt"
                required
                readonly
              />
            </div>

            <!-- Submit Button -->
            <button type="submit" class="button button-secondary">
              Submit
            </button>
          </form>
        </div>

        <!-- Payment -->
        <div class="purchase-section">
          <h3>Purchase Details</h3>
          <form id="purchase-form" class="purchase-form">
            <div class="form-group">
              <label for="totalAmount">Total Amount</label>
              <input
                type="number"
                id="totalAmount"
                name="totalAmount"
                required
                readonly
              />
            </div>
            <div class="form-group">
              <label for="discount">Discount</label>
              <input
                type="number"
                id="discount"
                name="discount"
                min="0"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label for="finalAmount">Final Amount</label>
              <input
                type="number"
                id="finalAmount"
                name="finalAmount"
                required
                readonly
              />
            </div>
            <div class="form-group">
              <label for="paymentAmount">Payment Amount</label>
              <input
                type="number"
                id="paymentAmount"
                name="paymentAmount"
                required
                min="0"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label for="remainingDebt">New Total Debt</label>
              <input
                type="number"
                id="remainingDebt"
                name="remainingDebt"
                readonly
              />
            </div>
            <button type="submit" class="button button-secondary">
              Complete Purchase
            </button>
          </form>
        </div>
      </section>
    </main>

    <!-- CHECK LATER !! -->
    <div id="newProductModal" class="modal">
      <form id="newProductForm" class="modal-content">
        <span class="close">&times;</span>
        <div class="form-group">
          <label for="productName">Product Name</label>
          <input
            type="text"
            id="productName"
            name="productName"
            value="kokaw"
            required
          />
          <small class="form-text">Enter the name of the product.</small>
        </div>

        <div class="form-group">
          <label for="productTaxes">Taxes (%)</label>
          <input
            type="number"
            id="productTaxes"
            name="productTaxes"
            step="0.01"
            min="0"
            value="1.2"
          />
          <small class="form-text">
            Enter the applicable tax percentage.
          </small>
        </div>

        <div class="form-group">
          <label for="subunitsInUnit">Subunits in 1 Unit</label>
          <input
            type="text"
            id="subunitsInUnit"
            name="subunitsInUnit"
            placeholder="e.g., 1 box contains 8 bottles"
            value="6"
            required
          />
          <small class="form-text">
            Specify the number of subunits (e.g., bottles) in one unit (e.g.,
            box).
          </small>
        </div>

        <div class="form-group">
          <label for="productDescription">Description (Optional)</label>
          <textarea
            id="productDescription"
            name="productDescription"
            placeholder="Product first creation"
            rows="3"
          ></textarea>
        </div>

        <button
          type="submit"
          onclick="createNewProduct()"
          class="button button-secondary"
        >
          Add Product
        </button>
      </form>
    </div>

    <script src="../../../scripts/common/Searchbar.js"></script>
    <script src="../../../assets/js/modal.js"></script>
    <script src="buying.js"></script>

    <!-- Handle the creation of new product -->
    <script>
      document
        .getElementById("newProductForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault(); // Prevent the default form submission

          // Collect the product data
          const productName = document.getElementById("productName").value;
          const productTaxes =
            parseFloat(document.getElementById("productTaxes").value) || 0;
          const subunitsInUnit = parseInt(
            document.getElementById("subunitsInUnit").value
          );
          const productDescription =
            document.getElementById("productDescription").value || "";

          // Create the product data object
          const productData = {
            productName: productName,
            taxes: productTaxes,
            subunitsInUnit: subunitsInUnit,
            // description: productDescription, -- ADD LATER WHEN CREATING THE PROFUCT HISTORY
          };

          console.log("ProductData ", productData);

          try {
            const result = await window.electronAPI.products.create(
              productData
            );

            if (result.success) {
              console.log("Product created successfully with ID:", result.id);
              document.getElementById("newProductForm").reset();
              document.getElementById("newProductModal").style.display = "none";
            } else {
              console.error("Failed to create product:", result.error);
            }
          } catch (error) {
            console.error("Error creating product:", error);
          }
        });
    </script>
  </body>
</html>
